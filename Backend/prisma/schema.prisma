generator client {
  provider = "prisma-client-js"

}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Priority {
  LOW
  MEDIUM
  HIGH
}

enum Status {
  PENDING 
  INPROGRESS
  DONE
}

model User {
  id String @id @default(uuid())
  email String @unique 
  name String
  password String? 
  passwordChangedAt DateTime? 
  verified Boolean @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime? @updatedAt

  task Task[]
  team Team[] @relation("Mempers")
  ownerTeam Team[] @relation("OwnerTeam")
  otpDetails Otp[]
  verificationTokens VerificationToken[]
}

model Task {
  id String @id @default(uuid())
  title String
  description String?
  priority Priority @default(LOW) 
  status Status @default(PENDING)
  completed Boolean @default(false) 
  dueDate DateTime?
  createdAt DateTime @default(now())
  updatedAt DateTime? @updatedAt
  userId String 

  user User @relation(fields: [userId],references: [id] ,onDelete: Cascade)
  @@index([priority])
  @@index([completed])
  @@index([dueDate])

}

model Team {
  id String @id @default(uuid()) 
  name String 
  description String? 
  ownerId String 
  createdAt DateTime @default(now())
  updatedAt DateTime? @updatedAt

  tasks TeamTask []
  user User [] @relation("Mempers")
  owner User @relation("OwnerTeam",fields: [ownerId],references: [id])
}

model TeamTask{
  id String @id @default(uuid())
  title String
  description String?
  priority Priority @default(LOW) 
  status Status @default(PENDING)
  completed Boolean @default(false) 
  dueDate DateTime? 
  createdAt DateTime @default(now())
  updatedAt DateTime? @updatedAt 
  teamId String 

  team Team @relation(fields: [teamId],references: [id],onDelete: Cascade)
  
}

model Otp {
  id String @id @default(uuid()) 
  otp String 
  otpExpiry DateTime
  createdAt DateTime @default(now())

  userId String 
  user User @relation(fields: [userId],references: [id],onDelete: Cascade)

  @@index([otpExpiry])
}

model VerificationToken {
  id String @id @default(uuid())
  token String 
  tokenExpiry DateTime 
  createdAt DateTime @default(now())

  userId String 
  user User @relation(fields: [userId],references: [id],onDelete: Cascade)
  @@index([tokenExpiry])
}
